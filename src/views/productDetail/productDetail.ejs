<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>상품 검색 페이지</title>
	<!-- 아이콘 -->
	<link rel="icon" type="image/png" sizes="16x16" href="/elice-rabbit-favicon.png" />
	<!-- bulma css -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css" />
	<!-- 폰트 어썸: 아이콘 -->
	<script defer src="https://kit.fontawesome.com/9daa42bcef.js" crossorigin="anonymous"></script>
	<!--css 관련-->
	<link rel="stylesheet" href="/productDetail/productDetail.css" />
</head>

<body>
	<!--헤더-->
	<nav class="navbar" role="navigation" aria-label="main navigation">
		<div class="container mt-3">
			<div class="navbar-brand">
				<a class="navbar-item" href="/">
					<img src="/elice-rabbit.png" width="30" height="30" />
					<span class="has-text-link">쇼핑-n팀</span>
				</a>

				<a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false"
					data-target="navbarBasicExample">
					<span aria-hidden="true"></span>
					<span aria-hidden="true"></span>
					<span aria-hidden="true"></span>
				</a>
			</div>

			<div class="navbar-end breadcrumb my-auto" aria-label="breadcrumbs">
				<ul id="navbar">
					<li><a href="/login">로그인</a></li>
					<li><a href="/register">회원가입</a></li>
					<li>
						<a href="#cart" aria-current="page">
							<span class="icon">
								<i class="fas fa-cart-shopping"></i>
							</span>
							<span>카트</span>
						</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>
	<!--상세 페이지-->
	<div class="box column is-four-fifths mx-auto">
		<!--상품 사진, 이름, 가격, 남은 재고, 카테고리, 가격-->
		<div class="column is-full is-flex">
			<!--이미지-->
			<div class="column is-half">
				<img id="image" src="<%=product.image.path%>">
			</div>
			<!--이름, 가격, 남은 재고, 카테고리-->
			<div class="column is-half">
				<div class="">
					<div class="">
						<span id="title">
							<%=product.title%>
						</span>
					</div>
					<div class="">
						<span id="price">
							<%=product.price%>
						</span>
						<span id="quantity">남은 수량: <%=product.quantity%></span>
					</div>
					<div class="">
						<span id="categoryName">
							<%=product.category.name%>
						</span>
					</div>
					<form class="form">
						<div class="">
							<div class="">
								<label>수량</label>
								<input type="number" value=1 id="count" min="1" max="9">
							</div>
							<span id="totalPrice">
								<%=`${product.price.toLocaleString()}원`%>
							</span>
						</div>
						<div class="">
							<button class="button" id="addCartBtn">장바구니 추가</button>
							<script>
								const addCartBtn = document.getElementById("addCartBtn");
								const countInput = document.getElementById("count");
								const totalPriceSpan = document.getElementById("totalPrice");
								//수량 변경 시 가격도 변경되는 기능
								countInput.addEventListener("change", (ev) => {
									ev.preventDefault();
									let totalPrice = Number(countInput.value) * "<%=product.price%>";
									totalPriceSpan.innerText = `${totalPrice.toLocaleString()}원`
								})
								//장바구니 추가 시 localStorage에 저장되는 기능
								addCartBtn.addEventListener("click", (ev) => {
									ev.preventDefault();
									const count = countInput.value;
									let newProduct = {id : "<%=product._id%>", count: Number(count)};
									//장바구니에 products 가져오기
									let localProducts = localStorage.getItem("products");
									let products;
									if( localProducts)
										products= JSON.parse(localProducts);
									if(!products){
										console.log("새 리스트 생성");
										products=[];
									}
									if(products.find(product => product.id === newProduct.id)){
										alert("이미 같은 상품이 장바구니에 존재합니다.");
										return;
									}
									products.push(newProduct);
									localStorage.setItem("products", JSON.stringify(products))
									alert("장바구니에 추가되었습니다.");
								})
							</script>
							<button class="button" id="buyBtn">구매</button>
						</div>
					</form>
				</div>
			</div>
		</div>
		<!--상품 discription-->
		<div>
			<span id="description">
				<%=product.description%>
			</span>
		</div>
	</div>

</body>

</html>
